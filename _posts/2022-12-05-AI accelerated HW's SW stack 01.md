# AI芯片软件栈（一）

> Some other hardware could be just as good in terms of raw processing, power model, memory, and kinds of architecture and so on. If they don't have a good software stack, they're simply not competitive. -- **Luis Ceze**: [Accelerating Machine Learning Systems](https://wandb.ai/wandb_fc/gradient-dissent/reports/Luis-Ceze-Accelerating-Machine-Learning-Systems--Vmlldzo4MDA3OTk?galleryTag=gradient-dissent)
> 
> **如果只有看起来很厉害的硬件，没有好的软件栈，将毫无竞争力！**

说到AI芯片的软件栈，这是一个非常宏大的主题，如果从驱动、固件到软件栈核心到MLOps支持，全链路的去考虑这个软件栈，涉及的知识广度已经超越了绝大多数人的技术储备，而细节层面的复杂性几乎可以说超越了小团队/个人可以把控的复杂度上限，所以，我很清楚我显然不可能全部驾驭，只能说到哪算哪；另外，一次性全部写完真不知道要写多久（摸鱼难，人也懒），所以准备分成几个部分来慢慢完成。

为了不浪费大家宝贵时间，先说几个想法，如果觉得这些观点有一些共识，那么看看也无妨，如果觉得完全是胡扯，或者咱们三观不一致，八字不合，那就不用浪费时间了，做标题党博眼球的自媒体挺没意思的。

  - **软件栈**全链路的规划（软件产品路线图）与设计目标，不能是为了实现某些局部的极端技术理想，而是要为**商业目标**服务
  - 编译器是最难、最重要的，但必须意识到**编译器**仅仅是新硬件的**软件栈**的**一部分**，切不可一叶障目，顾此失彼
  - 对开源软件的~~白嫖~~改造，如果涉及到大量的**代码侵入**，最好考虑清楚是否有更优解，或者将来如何升级，磨刀不误砍柴工
  - 精心设计的架构与接口非常重要，才能比较轻松的实现软件的前后向**兼容**与未来的**扩展**迭代
  - 提供极致的**性能**与提供一套好用的**编程模型**与**稳定**的**运行时**同样重要
  - 某种意义上，**文档**与**参考代码**就是公司的**窗口**与**形象**，值得投入人力与精力认真对待

先暂时说这几条，以我自己对自己的认识，估计写着写着可能会有新想法或者部分否定自己，这都是正常的，毕竟啊，善于总结和反思不是什么坏习惯，对吧？💪💪💪

今天先说第一部分。

# 软件栈与营收

咋一看这好像是风牛马的两个事情，为什么要放到一起来说？所以先解释一下我的观点：

> AI芯片公司，做芯片（准确说现阶段主要卖的是板卡，下同）是为了卖出去吧。
>
> 没有软件的芯片，那不过是昂贵的沙子，所以：
>
> 还要为芯片开发一套软件，让用户能按预期用起来芯片，才有可能下单，对吧。
>
> 事实上，流片回来，只要验证符合spec的设计目标，芯片能不能用，好不好用，有没有客户买单，基本就是软件说了算了。
>
> 所以，基本可以理解为：芯片量产是前提，**软件是营收的充分必要条件，且营收与软件完备度正相关**。

软件是芯片商业落地的保障，那么AI芯片公司，在规划**2亿营收**这个目标的时候，有没有考虑过下面这两个非常现实的问题：

> - **软件要做到什么样子，有哪些关键功能必须预判并提前实现，才能关键时刻不掉链子，支撑起来2个亿的营收目标**；
>
> - **软件与交付团队要做哪些人才、人力、方法论、标准化储备，才能保障2个亿营收的交付压力**。

我猜，大概率没有，因为正如上一篇所说的，大多数技术创业者，对于如何做生意这件事，理解的真的太少了。

按下面逻辑来简单捋一下看看怎么规划软件栈看起来合理点，算是抛砖吧。

营收预测 --> 软件刚需 --> 软件版本计划 --> 标准化、方法论准备 --> 售前、交付团队持续培训 --> 反馈、变更、完善实现正向闭环。

## 营收预测

> 从上篇文章有过互动的朋友的背景来看，以技术为绝对主力，所以大家可能对**营收预测**这件事，没太多的概念，先简单说一下，方便判断后续观点是否能站得住脚。

营收（销售）预测，绝对不是靠**拍脑袋**选出来一个能让自己开心的数字，就完事了的（但，目前的AI芯片公司，有几家不是这样拍出来的？）。道理很简单，`拍`出来的数字，几乎就没有任何可执行或者可跟踪的机会，只能是年初雄心壮志，形式一片大好，年终客观原因，明年会更好的。

虽然`科学`这个词真的被太多太多太多的**滥用**了，啥都可以`科学`，但是，从**销售管理**这个管理主题来说，营收（销售）预测，是真的有一些科学或者有效方法的，**销售漏斗**就是一个喜闻乐见的模型。

### 销售漏斗概念

首先，我们要对`销售线索`和`商机`区分清楚。

`销售线索`是什么，简单说就是“听说，某某公司明年准备采购500张AI加速卡……”，这信息大概率就真是一个**信息**，某种意义上，啥也不是，除了能成为销售出差拜访客户的理由外，暂时对公司没啥意义。

`商机`是什么，简单说就是对`销售线索`进行了核实，明确了更多的细节，也基本搞清楚了对方的决策链，感觉还是有机会攻一下的。这些细节有哪些呢，大概是这些`故事`：他们过去每年都有300～800片的T4采购量，所以明年这个500片看起来数字靠谱；主要业务场景是跑目标检测、分割这些CV模型；对国产卡不排斥，某某家已经在送测了；对解码密度和精度比较看重；对价格比较敏感，希望降低采购成本；算法工程师C++水平好像一般，希望能提供Python的API测试；决策流程是……，某某和某某某已经对接了，其中某某是过去某关系的朋友；吧啦吧啦下来大家觉得看起来不错喔，立项吧，跟跟看。

第二，对于靠谱的`商机`肯定要跟下去的，那就进入了`意向`或者`施加影响`阶段（各行有各行的，各领域有各领域的，各公司有各公司的，专有名词这东西吧，很多时候就是让外行觉得**高大上**，其实就是那么个意思，造词这件事（比如互联网黑话、阿里味）有时候真的很没意思）。

对AI芯片这个行业来说，这个阶段其实是大家最喜闻乐见和干过不少的：**送测**。没太多好展开说的，既然郎有意，那就必须赶紧展示妾有情嘛，如果模型适配、精度、性能都通过初步验证算是过了关，如果有好的售前和解决方案，针对客户场景和你方芯片优势，再能讲出来一个让对方觉得`终于等到你`的故事，那这个阶段就更完美了，对吧。下一步，那就是想办法让对方明确采购`意向`，大多数情况下这是水到渠成的事情了（虽然实操中从来没有什么水到渠成，讲故事嘛，还是要搞点艺术渲染，哈哈哈哈）。

第三，折腾这么久终于进入实质性`决策`环节了，芯片行业一般叫这个阶段是`Design in`。

毕竟初筛通过，双方基本信任也建立了，毕竟大家都挺忙的，谁也没空在没意义的事情上浪费时间，可以实质性的深入测试、验证、提需求，方便测出决策依据了。这个阶段，其实也是让很多AI芯片公司感受到各种花式**Surprise**最多的环节，其实也是今天这篇的核心观点的主要出处。

让人能做决策，下决心买单，不是跑个Yolo，ResNet50就完事了，一个生产系统切换到一套新的软硬件，不能说要和原来的一模一样，只能说和原来的要几乎一摸一样，然后得到的收益要明显大于切换的成本才行。

第四，结果总是很简单`Win` ro `Loss`，`签单`或者`丢单`，无需多说。

好了，到这里，大家快速增加了一点新的知识储备，让我们继续前进。

### 不负责任的做个营收预测模型

稍等，我们先回忆下上一篇说的四个主要`AI芯片目标市场`：互联网/云计算，运营商，G和大B，以及ISV。虽然，上篇说了前三个市场要拿下没那么容易，时间也远没有**预计**中那么快，但是，梦想总是要有的，万一实现了呢。

所以，后续的分析的营收预测模型，在我自己的认知范围内是**相当不靠谱**的（当年非常难实现，如果做个3年的预测，靠谱度会高很多，但是目前投资环境不等人啊，就按一年来说吧。），但为了简化事情，也为了更符合从业者现在看到、听到的信息，还是就按这个不那么靠谱的模型来分析。

上面这句话的意思其实是：我觉得我已经把尺子放的非常松了，其实还不够松，大家如果准备对下面说的事情准备按图索骥的琢磨下自己公司，强烈建议**打五折**来看。

既然是模型，那一定会需要设定一些假定和依赖，以求降低模型复杂度，方便得出一些结论。

> **假定1**
>
> 下一年度的营收目标是：人名币 2 亿元。
>
> 我们先不去探讨是纯卖卡的收入还是连服务器等都算进来的`Revenue`。

> **假定2**
>
> 我们有很好的`关系`，在互联网/云计算，运营商及B和大B市场都有非常明确的市场机会。

> **假定3**
>
> 我们有足够规模的销售团队，上一年`储备的商机`已经足够支撑下一年度的~~故事~~预测。

> **假定4**
>
> 我们有足够的售前、FAE及售后，可以支撑我们需要的量级的工作量。

> **假定5**
>
> 我们软件团队有足够的工程师，来支撑需要的开发工作快速完成。
>
> 我们软件团队有出色的架构师、技术产品经理和技术决策者，保证我们每一步都能走对。

#### 收入分解

既然需要2个亿的收入，那么肯定只有把任务分解开来，才好做几件事：

  - 观测这个预测靠谱程度有多大
  - 分解细化到具体可执行/跟踪的计划（翻译成人话：每个销售背多少数字）
  - 判断我们的资源储备情况能不能跟得上
  - 判断哪些事情必须提前做好
  - 知道完成可能性有多大，来年还有再去找多少靠谱商机才有机会完成目标

下面基于上面的5个假定，以本人**臆想**的**看起来逻辑合理**的思路对2亿的目标收入做个极简的分解，目标就是能把意思表达清楚即可：

2亿营收拆解为：
  - ISV：3000万
  - 互联网：5000万
  - 运营商/G/大B：1.2亿

进一步不负责任的分解如下：

> - 以某上市芯片公司财报数据为参考，在芯片销售初期，每年能在ISV销售侧拿下三千万订单，真的不少了。单个ISV的年采购量能到三百万已经不算小公司了，考虑到刚接触试试看的心态更重，所以需要有：**15家**ISV的订单来产出3000万收入是相对比较合理的预估；
>
> - 互联网/云计算虽然采购量不小，但是基于上一篇的讨论，全量给到新芯片的可能性个人真觉得不大，另外，互联网服务器是定点厂商，卖整机几乎不可能，只有单独卖卡的收入，所以，需要有：**3家**互联网的订单来产出5000万收入是相对比较合理的预估；
>
> - 理论上，一个**大项目**签2个亿都不算太大的单子，但是这种好单子几率不高，前期工作量不小，咱稍微现实点，不能太乐观了。所以，就假设分包也好，联合体也罢，反正真的人脉爆棚，有**2个**此类订单来产出1.2亿收入（实际上，大单子能当年确认全部收入的情况非常罕见，或者说几乎不可能，依然为了简单化问题讨论，这个细节咱也忽略了，老司机别喷我不懂行就行）。

好了，营收都落到行业销售头上了，来数一下未来一年我们合理的**签单客户**数量：

> 15个ISV
>
> 3个互联网
>
> 2个大项目

#### 销售漏斗

还记得前面科普的销售漏斗的一点点知识点么，销售漏斗为啥叫这个名字，因为**形象**啊（赶紧一键三连，然后跳出去百度，看下直观的图片解释再回来😁😁😁）。从销售线索到最终成交，这个漏斗真能漏下去的真不多，确实不多，非常不多。

那么问题来了。

我们的2亿营收目标是漏斗出来的合同，那么我们按照漏斗的逆序往上考察一下这个问题：**需要多少靠谱商机才能达成目标合同**。

这里又要继续开始为了简化问题，开始假设了。

> **假定6**
>
> 本来公开市场竞争就非常惨烈，做点生意不容易，现在大家芯片都回来了，竞争更激烈了，所以对ISV行业的销售签单率，我们定义为：`33%（即：1/3）`。老销售都知道这个比例是多高了。
>
> **假定7**
>
> 互联网和大项目，**运气**（自己琢磨什么是运气吧）对了怎么都有，否则怎么都挺难，但是本着国产替代和供应链安全这两个主题的客观存在，这两个行业的销售签单率，我们定义为：`50%（即：1/2）`。

基于上述两个假设，和前面的**签单客户**数量，那么我们应该在手的商机是多少呢？

> **ISV**：9000万商机/45个潜在客户
>
> **互联网**：1亿商机/6个潜在客户
>
> **大项目**：2.4亿商机/4个潜在大项目

事情到这里看起来已经有点儿严峻了，来笑一个，别那么悲观么，人定胜天。笑完了么，继续往下看，事情还没完呢。

前面说了销售线索和商机不是一码事，只有接触了，初步沟通了，也判断有**拿下**的机会的销售线索才能叫商机，所以，让我来继续假设。

> **假定8**
>
> 由于AI芯片这个行业的特殊性，目标行业比较清晰，所以我们有理由相信，销售线索到商机的转化率还是比较高的，所以假定：
>
> ISV：66%，也就是3个线索能变出来2个商机（好可怕的效率）
>
> 其余：75%，也就接触到4个项目机会，3个能看起来像有生意。

所以，终极数据可以出来了，要完成2亿的营收，实际上我们目前在手的销售线索和潜在客户数量应该是：

> **ISV**：1.3亿线索和商机/70个左右潜在客户
>
> **互联网**：1.3亿线索和商机/8个潜在客户
>
> **大项目**：3.2亿线索和商机/5个潜在大项目

当然，这些数字不是说要我们在年底全部在手了才能做预测。如果，年底我们真储备了这么多机会，那么来年的目标达成率肯定高很多。当然，还有一年呢，我们完全可以有理由**鼓励**自己，虽然现在手里机会不多，但是来年我们找到这么多机会。现实点来说，一半一半吧，储备占一半，来年再找一半，可能才是比较理智和现实的。

所以到这个时候，其实喊一个：下一年营收预期 5.8 亿也行，也没什么不合适的，对吧。

那么问题来了，废这么大篇幅说了一堆基于各种假设的废话，想表达什么？让我们进入下一个主题。

## 交付压力

基于上述对于营收的不负责任的预测，我们得到了几个关键的信息：

> 来年，我们要：
> 
> FAE与AE能支持超过`80`个客户的产品测试与业务代码迁移遇到的各种奇奇怪怪的问题。
>
> 而且其中`70`个ISV的下游客户不可能高度集中，一个ISV可能就冒出来`10`个不同的项目，不可忽视其中存在的模型及软件特定feature需求。
>
> 软件团队能支持并且是高效支持好上述客户的看起来奇奇怪怪的需求。
>
> 售前团队能支持上述客户的售前活动。

当然这些工作量压力，是不可能**平均分配**到12个自然月的。而且，一般的理解上，1、2两个月春节前后放羊、收心；11、12两个月年终总结、下年预算，这四个月对销售来说，效率是非常不高的，那么一年就剩下了**8个月**是产出率高的时间段，考虑到销售即使技巧再高，逼单手艺再丝滑，都是要时间的，流程总要一步一步走的，而且合同签了到交付、验收回款还是有时间的。

技术同学也要理解理解看起来就是吃吃喝喝的销售同学的苦逼和艰辛，啥活都不好干，啥饭都不好吃，给销售兄弟也留点时间和腾挪空间，别算时间的时候只考虑自己研发周期。

好了，大家互相理解了，但是2个亿的目标还要完成，本来说好是一年的事情，可能就变成这样了：

  - 八月底前，起码要把80%的合同签订前期技术工作做完，给销售签单、交付、年底前回款留够时间。
  - 十月底前，尽量把阻碍验收的问题全部解决了，给销售回款留够时间。

再考虑到1、2两个月基本没太多事情，也就是说从售前到交付的绝大多数任务要在6到8个月内完成，2亿营收才稳一点。

这就是说，峰值人力需求，起码是平均值的**三倍**，才能扛住营收压力带来的工作任务和强度压力。

由于每个客户的支持不是说一天两天就结束的，有可能持续几个月，人的绝对数量需求，这事情不是互联网流量能玩“削峰填谷”，也没有“弹性扩容”这种好事，硬碰硬的事情，从来没有凭运气的，只有靠实力。

但，这个实力绝对不是：**提前招一堆人**。

其实，就算公司有钱养人，能做好AI芯片的FAE，我的理解是：算法、推理软件栈、视频编解码、PEIe设备、服务器、操作系统、网络、虚拟化、容器、K8S、数据中心这些奇奇怪怪的技术点懂一半是需要的吧，以目前AI芯片圈子的总体人才数量，就算不怕烧钱，也招不到那么多啊。

那么这个问题怎么破？

简单说就是这个问题没法回答。各公司情况、阶段、人力储备、管理风格、协作程度以及大技术体系有几个分管VP、那边话语权高、山头多不多，这些情况都不一样，求一个通用解是不可能的。

当然，只要是问题，都可以试着去从几个思路下手试试看，比如：

> - AE 做为 FAE 的二线，在关键时刻顶到一线不是不可以嘛（当然，人要机灵点，别出门瞎说大实话）。
>
> - FAE 天然就具有售前属性，在关键时刻顶一下售前的缺，出去念念PPT，忽悠忽悠也是可以的嘛（当然，不能太老实的，啥都say no也不行）。
>
> - QA 对自己的软件栈非常熟悉么，潜伏在客户支持群里，帮着FAE和AE盯一下，解决点问题不是不可以嘛（当然，不能是个问题都往回来揽，有些活就是客户自己的）。
>
> - 解决方案、售前也不是都只会画PPT，也有技术背景不错的，这时候不上，什么时候上。
>
> - 关键大客户的支持，级别够的领导亲自跟一下么，了解一线火力，有助于做决策的时候判断准确。
>
> - 人还不够用，可以看看研发的兄弟们，有没有思路清楚，口才过关，和陌生人打交道也不怵的，可以顶一顶纯技术的对接。

创业公司，专业化很重要，通才也很重要，没有一批人做什么像什么，放到哪里都能发光的，能很好应对突发的人力需求峰值的，真的很难搞成大事。否则就是招很多冗员，一年忙2个月，其余10个月悄悄摸鱼还好，就怕无事生非，非要给自己加戏，这种公司几乎没有内部不乱的。

上面的这人员复用策略，也**不是银弹**，只要有点管理经验和人员调动权限，都能想到，但是能不能做好，是另外一件事。

前面说了，时间紧，任务重，压力大，这时候其实比较忌讳把人动来动去的，比较容易让具体干活的兄弟产生迷失状态：我是谁，我在哪，我该干什么，我要干什么。但，当这种调动成为有且仅有的解决方案的时候，当领导的，工作还是要做细一点。

第一，提前沟通好，让大家早早完成心理建设阶段。

第二，对调动和轮转安排，有个预判和安排，让大家提前能结对，知道发生什么事情，自己什么角色，什么任务，和谁配合，找谁支持。事到临头慌慌张张抓壮丁，不乱，不掉链子只能说命硬。

第三，说清楚锅来了，不是干活的背，否则临时顶缺，本来是帮公司解决问题，结果给自己解决回来一口大黑锅，谁不怕。

第四，提前培训，甚至，面试的时候就要琢磨下这些岗的候选人，还能帮什么岗顶一顶。当然，这里有个前提，面试官真是要站在公司一盘棋角度考虑问题，而不是山头主义。

第五，文档和知识管理一定提前做好。刚开始接触客户，各种已知问题，奇怪异常的解决方案等等，如果仅仅作为经验在特定人员脑袋中，一个坑每个人都踩一遍，这事情是非常可怕的。

第六，做好软件规划和版本管理，出门的软件版本越少，支持工作量越少，如果软件玩出来N多个版本，基本上就离那个啥那个啥了。

好了，终于说到软件了。

